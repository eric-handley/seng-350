<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>UVic Booking â€“ Module View</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- UMD build is simplest for local files -->
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({ startOnLoad: true });
  </script>
  <style>
    body { margin:16px; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif }
    .mermaid { max-width: 100%; }
  </style>
</head>
<body>
<h1>Module View (UML Component Diagram)</h1>
<div class="mermaid">
classDiagram
    direction TB

    class ClientApp {
        ReactRouter
        AuthContext
        TabNavigation
    }

    class LoginPage {
        UserAuthentication
        FormValidation
        ErrorHandling
    }

    class BookingPage {
        RoomSearchFilters
        AvailabilityDisplay
        BookingCreation
        TimeSelection
    }

    class SchedulePage {
        ScheduleView
        BuildingFilter
        DateSelection
        RoomAvailability
    }

    class HistoryPage {
        BookingHistory
        CancelBookings
        UserBookings
        AllBookingsAdmin
    }

    class UsersPage {
        UserManagement
        AddEditUsers
        RoleManagement
        UserBlocking
    }

    class AdminConsole {
        AuditLogs
        SystemHealth
        AdminControls
        DarkMode
    }

    class AuthContext {
        LoginLogout
        SessionManagement
        RoleValidation
        UserState
    }

    class useRooms {
        RoomDataFetching
        FilterManagement
        LoadingStates
    }

    class useSchedule {
        ScheduleDataFetching
        AvailabilityQueries
        BuildingAggregation
    }

    class useBookingHistory {
        BookingCRUD
        OptimisticUpdates
        HistoryManagement
    }

    class useUsers {
        UserCRUD
        RoleManagement
        UserStateManagement
    }

    class ClientAPI {
        HTTPRequests
        AuthenticationHeaders
        ErrorHandling
        DataTransformation
    }

    class ServerApp {
        NestJSFramework
        TypeORMIntegration
        RedisCache
        SwaggerDocumentation
    }

    class AuthModule {
        JWTTokens
        PasswordHashing
        SessionManagement
        RoleGuards
    }

    class UsersController {
        GETusers
        POSTusers
        PUTusers
        DELETEusers
        RoleManagement
    }

    class BookingsController {
        GETbookings
        POSTbookings
        DELETEbookings
        SeriesBookings
        ConflictResolution
    }

    class RoomsController {
        GETrooms
        RoomFiltering
        CapacityQueries
        EquipmentFiltering
    }

    class ScheduleController {
        GETschedule
        AvailabilityQueries
        TimeSlotManagement
        BuildingOrganization
    }

    class BuildingsController {
        GETbuildings
        BuildingManagement
        RoomRelationships
    }

    class EquipmentController {
        GETequipment
        EquipmentManagement
        RoomEquipmentRelations
    }

    class AuditLogsController {
        GETauditlogs
        AuditTrail
        SystemMonitoring
    }

    class UsersService {
        UserCRUDOperations
        PasswordManagement
        RoleValidation
        DatabaseQueries
    }

    class BookingsService {
        BookingCRUDOperations
        ConflictDetection
        SeriesManagement
        TransactionHandling
    }

    class RoomsService {
        RoomQueries
        AvailabilityCalculation
        ScheduleGeneration
        FilteringLogic
    }

    class BuildingsService {
        BuildingManagement
        RoomAggregation
        DataOrganization
    }

    class EquipmentService {
        EquipmentManagement
        RoomEquipmentRelations
        FilteringSupport
    }

    class AuditLogsService {
        AuditLogging
        SystemMonitoring
        UserActivityTracking
    }

    class User {
        id: uuid
        email: string
        password_hash: string
        first_name: string
        last_name: string
        role: enum
        created_at: timestamp
        updated_at: timestamp
    }

    class Booking {
        id: uuid
        user_id: uuid
        room_id: string
        start_time: timestamp
        end_time: timestamp
        status: enum
        booking_series_id: uuid
        created_at: timestamp
        updated_at: timestamp
    }

    class BookingSeries {
        id: uuid
        user_id: uuid
        room_id: string
        start_time: timestamp
        end_time: timestamp
        series_end_date: date
        created_at: timestamp
        updated_at: timestamp
    }

    class Room {
        room_id: string
        building_short_name: string
        room_number: string
        capacity: number
        room_type: enum
        url: string
        created_at: timestamp
        updated_at: timestamp
    }

    class Building {
        building_short_name: string
        building_name: string
        created_at: timestamp
        updated_at: timestamp
    }

    class Equipment {
        id: uuid
        name: string
        description: string
        created_at: timestamp
        updated_at: timestamp
    }

    class RoomEquipment {
        id: uuid
        room_id: string
        equipment_id: uuid
        quantity: number
        created_at: timestamp
        updated_at: timestamp
    }

    class AuditLog {
        id: uuid
        user_id: uuid
        action: string
        resource_type: string
        resource_id: string
        details: json
        ip_address: string
        user_agent: string
        created_at: timestamp
    }

    class PostgreSQL {
        PrimaryDatabase
        ACIDTransactions
        RelationalData
        Indexing
    }

    class Redis {
        CachingLayer
        SessionStorage
        PerformanceOptimization
    }

    class DockerCompose {
        ContainerOrchestration
        ServiceManagement
        DevelopmentEnvironment
    }

    ClientApp *-- LoginPage
    ClientApp *-- BookingPage
    ClientApp *-- SchedulePage
    ClientApp *-- HistoryPage
    ClientApp *-- UsersPage
    ClientApp *-- AdminConsole
    ClientApp *-- AuthContext

    AuthContext ..> ClientAPI
    useRooms ..> ClientAPI
    useSchedule ..> ClientAPI
    useBookingHistory ..> ClientAPI
    useUsers ..> ClientAPI

    BookingPage ..> useRooms
    BookingPage ..> useBookingHistory
    SchedulePage ..> useSchedule
    HistoryPage ..> useBookingHistory
    UsersPage ..> useUsers

    ServerApp *-- AuthModule
    ServerApp *-- UsersController
    ServerApp *-- BookingsController
    ServerApp *-- RoomsController
    ServerApp *-- ScheduleController
    ServerApp *-- BuildingsController
    ServerApp *-- EquipmentController
    ServerApp *-- AuditLogsController

    UsersController ..> UsersService
    BookingsController ..> BookingsService
    RoomsController ..> RoomsService
    ScheduleController ..> RoomsService
    BuildingsController ..> BuildingsService
    EquipmentController ..> EquipmentService
    AuditLogsController ..> AuditLogsService

    UsersService ..> User
    UsersService ..> AuditLog
    BookingsService ..> Booking
    BookingsService ..> BookingSeries
    BookingsService ..> Room
    BookingsService ..> User
    RoomsService ..> Room
    RoomsService ..> Building
    RoomsService ..> Booking
    BuildingsService ..> Building
    BuildingsService ..> Room
    EquipmentService ..> Equipment
    EquipmentService ..> RoomEquipment
    AuditLogsService ..> AuditLog

    User *-- Booking
    User *-- BookingSeries
    User *-- AuditLog
    Room *-- Booking
    Room *-- BookingSeries
    Room *-- RoomEquipment
    Building *-- Room
    Equipment *-- RoomEquipment
    BookingSeries *-- Booking

    ClientAPI ..> ServerApp
    ServerApp ..> PostgreSQL
    ServerApp ..> Redis
    DockerCompose ..> ServerApp
    DockerCompose ..> PostgreSQL
    DockerCompose ..> Redis
</div>
</body>
</html>
